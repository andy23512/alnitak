"use strict";(self.webpackChunkalnitak=self.webpackChunkalnitak||[]).push([[193],{7193:(ut,v,a)=>{a.r(v),a.d(v,{ChordPageComponent:()=>pt});var t=a(4438),I=a(8834),m=a(9213),P=a(3902),h=a(6138),x=a(2510),f=a(8018);const B=(0,a(4019).A)(function(r,e){return Array.prototype.slice.call(e,0).sort(r)});var y=a(9189),S=a(1834),F=a(7508);function K(n,r){if(1&n&&t.EFF(0),2&n){const e=t.XpG().$implicit;t.SpI(" ",e.value," ")}}function R(n,r){if(1&n&&(t.j41(0,"mat-icon"),t.EFF(1),t.nI1(2,"iconGuard"),t.k0s()),2&n){const e=t.XpG().$implicit;t.R7$(),t.SpI(" ",t.bMT(2,1,e.value)," ")}}function G(n,r){1&n&&(t.j41(0,"span"),t.EFF(1,"+"),t.k0s())}function V(n,r){if(1&n&&t.DNE(0,K,1,1)(1,R,3,3)(2,G,2,0,"span"),2&n){const o=r.$index,i=r.$count;t.vxM(0,"character"===r.$implicit.type?0:1),t.R7$(2),t.vxM(2,o!==i-1?2:-1)}}let D=(()=>{class n{constructor(){this.keys=t.hFB.required()}static#t=this.\u0275fac=function(o){return new(o||n)};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["app-chord-input-keys"]],inputs:{keys:[t.Mj6.SignalBased,"keys"]},standalone:!0,features:[t.aNF],decls:2,vars:0,template:function(o,i){1&o&&t.Z7z(0,V,3,2,null,null,t.Vm6),2&o&&t.Dyx(i.keys())},dependencies:[m.An,y.B],encapsulation:2,changeDetection:0})}return n})();function W(n,r){if(1&n&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&n){const e=t.XpG().$implicit;t.R7$(),t.JRh(e.value)}}function N(n,r){if(1&n&&(t.j41(0,"mat-icon",0),t.EFF(1),t.nI1(2,"iconGuard"),t.k0s()),2&n){const e=t.XpG().$implicit;t.Y8G("inline",!0),t.R7$(),t.JRh(t.bMT(2,2,e.value))}}function Q(n,r){1&n&&t.DNE(0,W,2,1,"span")(1,N,3,4),2&n&&t.vxM(0,"character"===r.$implicit.type?0:1)}let T=(()=>{class n{constructor(){this.keys=t.hFB.required(),this.hostClasses=["inline-flex","align-center"]}static#t=this.\u0275fac=function(o){return new(o||n)};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["app-chord-output-keys"]],hostVars:2,hostBindings:function(o,i){2&o&&t.HbH(i.hostClasses)},inputs:{keys:[t.Mj6.SignalBased,"keys"]},standalone:!0,features:[t.aNF],decls:2,vars:0,consts:[[3,"inline"]],template:function(o,i){1&o&&t.Z7z(0,Q,2,1,null,null,t.Vm6),2&o&&t.Dyx(i.keys())},dependencies:[m.An,y.B],encapsulation:2,changeDetection:0})}return n})();const X=["fileInput"],L=(n,r)=>r.id;function U(n,r){if(1&n&&(t.j41(0,"mat-list-option",7),t.nrm(1,"app-chord-input-keys",9),t.EFF(2," -> "),t.nrm(3,"app-chord-output-keys",9),t.k0s()),2&n){const e=r.$implicit,o=t.XpG();t.Y8G("color","primary")("value",e)("togglePosition","before")("selected",o.selectedChordIds().has(e.id)),t.R7$(),t.Y8G("keys",e.inputKeys),t.R7$(2),t.Y8G("keys",e.outputKeys)}}const Y=B((n,r)=>n-r);let w=(()=>{class n{constructor(){this.chordStore=(0,t.WQX)(F.C),this.chords=t.hFB.required(),this.selectedChordIds=t.hFB.required(),this.selectionChange=(0,t.CGW)(),this.startPractice=(0,t.CGW)(),this.classes="flex flex-col"}loadChordFile(){if(typeof FileReader>"u")return;const e=this.fileInput.nativeElement;if(null===e.files||0===e.files.length)return;const o=new FileReader;o.onload=i=>{if(!i.target?.result)return;const s=JSON.parse(i.target.result);if(!s)return;let c=null;c=s.history?s.history[0].find(l=>"chords"===l.type):s,c&&(0,h.M8)(this.chordStore,(0,x.a8)(c.chords.map(([l,p])=>{const d=l.filter(dt=>dt>0);return{id:Y(d).join("_"),input:d,output:p}})))},o.readAsText(e.files[0])}onChordSelectionChange(e){this.selectionChange.emit(e)}static#t=this.\u0275fac=function(o){return new(o||n)};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["app-chord-practice-setting"]],viewQuery:function(o,i){if(1&o&&t.GBs(X,5),2&o){let s;t.mGM(s=t.lsd())&&(i.fileInput=s.first)}},hostVars:2,hostBindings:function(o,i){2&o&&t.HbH(i.classes)},inputs:{chords:[t.Mj6.SignalBased,"chords"],selectedChordIds:[t.Mj6.SignalBased,"selectedChordIds"]},outputs:{selectionChange:"selectionChange",startPractice:"startPractice"},standalone:!0,features:[t.aNF],decls:41,vars:42,consts:[["fileInput",""],[1,"flex","h-12","flex-none","items-center","bg-gray-700","px-5"],[1,"flex-1","list-inside","list-decimal","overflow-auto","p-5"],["href","https://charachorder.io/","target","_blank","rel","noopener",1,"underline"],["type","button","mat-flat-button","",1,"my-2",3,"click","color"],["hidden","","type","file","accept",".json",3,"change"],[1,"!my-2","max-h-56","overflow-auto","rounded","border",3,"selectionChange"],[3,"color","value","togglePosition","selected"],["type","button","mat-flat-button","",1,"my-2",3,"click","color","disabled"],[3,"keys"]],template:function(o,i){if(1&o){const s=t.RV6();t.j41(0,"section",1),t.EFF(1),t.nI1(2,"translate"),t.nI1(3,"realTitleCase"),t.k0s(),t.j41(4,"ol",2)(5,"li"),t.EFF(6),t.nI1(7,"translate"),t.j41(8,"a",3),t.EFF(9),t.nI1(10,"translate"),t.k0s(),t.EFF(11),t.nI1(12,"translate"),t.nrm(13,"br"),t.j41(14,"button",4),t.bIt("click",function(){t.eBV(s);const l=t.sdS(22);return t.Njj(l.click())}),t.j41(15,"mat-icon"),t.EFF(16),t.nI1(17,"iconGuard"),t.k0s(),t.EFF(18),t.nI1(19,"translate"),t.nI1(20,"realTitleCase"),t.k0s(),t.j41(21,"input",5,0),t.nI1(23,"translate"),t.bIt("change",function(){return t.eBV(s),t.Njj(i.loadChordFile())}),t.k0s()(),t.j41(24,"li"),t.EFF(25),t.nI1(26,"translate"),t.j41(27,"mat-selection-list",6),t.bIt("selectionChange",function(l){return t.eBV(s),t.Njj(i.onChordSelectionChange(l))}),t.Z7z(28,U,4,6,"mat-list-option",7,L),t.k0s()(),t.j41(30,"li"),t.EFF(31),t.nI1(32,"translate"),t.nrm(33,"br"),t.j41(34,"button",8),t.bIt("click",function(){return t.eBV(s),t.Njj(i.startPractice.emit())}),t.j41(35,"mat-icon"),t.EFF(36),t.nI1(37,"iconGuard"),t.k0s(),t.EFF(38),t.nI1(39,"translate"),t.nI1(40,"realTitleCase"),t.k0s()()()}2&o&&(t.R7$(),t.SpI(" ",t.bMT(3,16,t.bMT(2,14,"chord-page.chord-practice-setting.title")),"\n"),t.R7$(5),t.SpI(" ",t.bMT(7,18,"chord-page.chord-practice-setting.import-chord-list-file-step.0")," "),t.R7$(3),t.SpI("",t.bMT(10,20,"chord-page.chord-practice-setting.import-chord-list-file-step.1")," "),t.R7$(2),t.SpI(" ",t.bMT(12,22,"chord-page.chord-practice-setting.import-chord-list-file-step.2")," "),t.R7$(3),t.Y8G("color","primary"),t.R7$(2),t.JRh(t.bMT(17,24,"upload")),t.R7$(2),t.SpI(" ",t.bMT(20,28,t.bMT(19,26,"general.choose-file-action"))," "),t.R7$(3),t.BMQ("aria-label",t.bMT(23,30,"chord-page.chord-practice-setting.file-input-aria-label")),t.R7$(4),t.SpI(" ",t.bMT(26,32,"chord-page.chord-practice-setting.select-chords-step")," "),t.R7$(3),t.Dyx(i.chords()),t.R7$(3),t.SpI(" ",t.bMT(32,34,"chord-page.chord-practice-setting.click-start-button-step")," "),t.R7$(3),t.Y8G("color","primary")("disabled",0===i.selectedChordIds().size),t.R7$(2),t.JRh(t.bMT(37,36,"play_arrow")),t.R7$(2),t.SpI(" ",t.bMT(40,40,t.bMT(39,38,"general.start-action"))," "))},dependencies:[I.$z,m.An,P.p6,P.oh,D,T,y.B,f.D9,S.B],encapsulation:2,changeDetection:0})}return n})();var A=a(1635),O=a(8954),k=a(9894),H=a(605),z=a(6148),_=a(1380),J=a(1159),Z=a(4796),C=a(6898);const j=(0,h.Eu)({providedIn:"root"},(0,Z.JT)("chordPractice"),(0,h.Q2)({chords:null,queue:[],history:[],lastCorrectChordTime:null,chordIntervals:[],buffer:[]}),(0,h.RI)(n=>({setChords(r){(0,h.M8)(n,()=>({chords:r,queue:(0,C.q)(r,20),history:[],chordIntervals:[]}))},airType(){(0,h.M8)(n,({queue:r,chords:e,history:o,lastCorrectChordTime:i,chordIntervals:s})=>{if(!e)return{};const c=Date.now();return{queue:[...r.slice(1),(0,C.QD)(e)],history:[...o,r[0]].slice(-3),lastCorrectChordTime:c,chordIntervals:i?[...s,c-i]:[...s],buffer:[]}})},input(r){(0,h.M8)(n,({buffer:e,queue:o,chords:i,history:s,lastCorrectChordTime:c,chordIntervals:l})=>{if(!i)return{};const p=Date.now(),d=[...e];if("deleteContentBackward"===r.inputType)d.pop();else{if("insertText"!==r.inputType||!r.data)return{};d.push(r.data)}return d.join("").trim()===o[0].outputText?{queue:[...o.slice(1),(0,C.QD)(i)],history:[...s,o[0]].slice(-3),lastCorrectChordTime:p,chordIntervals:c?[...l,p-c]:[...l],buffer:[]}:{buffer:d}})}})),(0,h.QO)(n=>({chpm:(0,t.EWP)(()=>{const r=n.chordIntervals(),e=r.reduce((i,s)=>i+s,0)/1e3/60;return 0===e?0:Math.floor(r.length/e)})})));var et=a(181),M=a(7877),ot=a(9263),u=a(2097),nt=a(5888),it=a(629);const rt=["input"];function st(n,r){1&n&&t.nrm(0,"app-chord-output-keys",5),2&n&&t.Y8G("keys",r.$implicit.outputKeys)}function ct(n,r){1&n&&t.nrm(0,"app-chord-output-keys",5),2&n&&t.Y8G("keys",r.$implicit.outputKeys)}function at(n,r){if(1&n&&(t.nrm(0,"app-speedometer",15),t.nI1(1,"translate")),2&n){const e=t.XpG();t.AVh("opacity-50",e.isFocus()),t.Y8G("speed",e.chordPracticeStore.chpm())("maxSpeed",100)("speedUnit",t.bMT(1,5,"general.chord-speed-unit"))}}let g=class b{constructor(){this.chordPracticeStore=(0,t.WQX)(j),this.visibilitySettingStore=(0,t.WQX)(ot.e),this.hotkeysService=(0,t.WQX)(O.dr),this.isFocus=(0,t.vPA)(!1),this.shortcuts={startPractice:"space",pausePractice:"escape"},this.classes="flex flex-col h-full",this.keyboardLayout=(0,t.WQX)(M.h).selectedEntity,this.deviceLayout=(0,t.WQX)(et.G).selectedEntity,this.airModeSettingStore=(0,t.WQX)(J.$),this.translateService=(0,t.WQX)(f.c$),this.practiceCharactersDevicePositionCodes=(0,t.EWP)(()=>{const r=this.chordPracticeStore.chords(),e=this.deviceLayout(),o=this.keyboardLayout();return[...new Set(r?.map(s=>s.input).flat())].map(s=>{const c=(0,u.VW)(s,o);return c?{c:c.value,characterDeviceKeys:(0,u.U)([{actionCode:s,shiftKey:!1,altGraphKey:!1}],e)}:null})}),this.keyLabelMap=(0,t.EWP)(()=>{const r=this.practiceCharactersDevicePositionCodes();if(!r)return{};const e={};return r.forEach(o=>{o?.characterDeviceKeys?.forEach(({characterKeyPositionCode:i,layer:s,shiftKey:c,altGraphKey:l})=>{const p={type:_.g0.String,c:o.c,title:this.translateService.instant("general.character-tooltip",{character:o.c}),layer:s,shiftKey:c,altGraphKey:l};e[i]?e[i].push(p):e[i]=[p]})}),e}),this.highlightChordKeyCombinationMap=(0,t.EWP)(()=>{const r=this.chordPracticeStore.chords(),e=this.deviceLayout();if(!this.practiceCharactersDevicePositionCodes())return{};const i={};return r?.forEach(s=>{i[s.id]={characterKeyPositionCode:-1,layer:_.Wd.Primary,shiftKey:!1,altGraphKey:!1,positionCodes:s.input.map(c=>(0,u.U)([{actionCode:c,shiftKey:!1,altGraphKey:!1}],e)?.map(l=>l.characterKeyPositionCode)).flat(),score:0}}),i}),this.highlightKeyCombination=(0,t.EWP)(()=>{const r=this.chordPracticeStore.queue()[0];return this.highlightChordKeyCombinationMap()[r.id]})}onInput(r){this.chordPracticeStore.input(r)}startPractice(){if(this.input.nativeElement.focus(),this.airModeSettingStore.enabled()){const e=this.airModeSettingStore.chordSpeed();(0,H.Y)(6e4/e).pipe((0,k.s)(this)).subscribe(()=>{this.chordPracticeStore.airType()})}}endPractice(){this.input.nativeElement.blur()}ngOnInit(){this.hotkeysService.addShortcut({keys:this.shortcuts.startPractice}).subscribe(()=>{this.startPractice()}),this.hotkeysService.addShortcut({keys:this.shortcuts.pausePractice,allowIn:["INPUT"]}).subscribe(()=>{this.endPractice()})}ngOnDestroy(){this.hotkeysService.removeShortcuts([this.shortcuts.startPractice,this.shortcuts.pausePractice])}static#t=this.\u0275fac=function(e){return new(e||b)};static#e=this.\u0275cmp=t.VBU({type:b,selectors:[["app-chord-practice"]],viewQuery:function(e,o){if(1&e&&t.GBs(rt,7),2&e){let i;t.mGM(i=t.lsd())&&(o.input=i.first)}},hostVars:2,hostBindings:function(e,o){2&e&&t.HbH(o.classes)},standalone:!0,features:[t.aNF],decls:27,vars:20,consts:[["input",""],[1,"flex","h-12","flex-none","items-center","bg-gray-700","px-5"],[1,"flex-none"],[1,"relative","h-16","overflow-hidden"],[1,"history","absolute","top-2","space-x-1","whitespace-nowrap","text-gray-300"],[3,"keys"],[1,"absolute","left-24","top-2","space-x-1","whitespace-nowrap"],[1,"absolute","bottom-2","left-24","whitespace-nowrap","text-alnitak-300"],[1,"animate-ping","border-l","border-solid","border-alnitak-300"],["type","text","inputmode","none",1,"peer","h-0","w-0","opacity-0",3,"input","focus","blur"],[1,"absolute","inset-0","flex","cursor-pointer","items-center","justify-center","gap-2","bg-gray-500","text-white","peer-focus:pointer-events-none","peer-focus:opacity-0"],["mat-flat-button","",3,"click"],[1,"text-white"],[1,"box-border","block","flex-1","overflow-hidden","px-5","pb-5",3,"showThumb3Switch","keyLabelMap","highlightKeyCombination"],["class","absolute bottom-4 right-4 h-24 w-24 opacity-50",3,"opacity-50","speed","maxSpeed","speedUnit",4,"appVisible"],[1,"absolute","bottom-4","right-4","h-24","w-24","opacity-50",3,"speed","maxSpeed","speedUnit"]],template:function(e,o){if(1&e){const i=t.RV6();t.j41(0,"section",1),t.EFF(1),t.nI1(2,"translate"),t.nI1(3,"realTitleCase"),t.k0s(),t.j41(4,"section",2)(5,"div",3)(6,"div",4),t.Z7z(7,st,1,1,"app-chord-output-keys",5,t.Vm6),t.k0s(),t.j41(9,"div",6),t.Z7z(10,ct,1,1,"app-chord-output-keys",5,t.Vm6),t.k0s(),t.j41(12,"div",7),t.EFF(13),t.nrm(14,"span",8),t.k0s(),t.j41(15,"input",9,0),t.bIt("input",function(c){return t.eBV(i),t.Njj(o.onInput(c))})("focus",function(){return t.eBV(i),t.Njj(o.isFocus.set(!0))})("blur",function(){return t.eBV(i),t.Njj(o.isFocus.set(!1))}),t.k0s(),t.j41(17,"div",10)(18,"button",11),t.bIt("click",function(){return t.eBV(i),t.Njj(o.startPractice())}),t.j41(19,"mat-icon",12),t.EFF(20),t.nI1(21,"iconGuard"),t.k0s(),t.EFF(22),t.nI1(23,"translate"),t.nI1(24,"realTitleCase"),t.k0s()()()(),t.nrm(25,"app-layout",13),t.DNE(26,at,2,7,"app-speedometer",14)}2&e&&(t.R7$(),t.SpI(" ",t.bMT(3,12,t.bMT(2,10,"chord-page.chord-practice.title")),"\n"),t.R7$(5),t.xc7("right","calc(100% - 96px)"),t.R7$(),t.Dyx(o.chordPracticeStore.history()),t.R7$(3),t.Dyx(o.chordPracticeStore.queue()),t.R7$(3),t.SpI(" ",o.chordPracticeStore.buffer().join(""),""),t.R7$(7),t.JRh(t.bMT(21,14,"play_arrow")),t.R7$(2),t.SpI(" ",t.bMT(24,18,t.bMT(23,16,"general.start-action"))," "),t.R7$(3),t.Y8G("showThumb3Switch",o.visibilitySettingStore.layoutThumb3Switch())("keyLabelMap",o.keyLabelMap())("highlightKeyCombination",o.isFocus()?o.highlightKeyCombination():null),t.R7$(),t.Y8G("appVisible","speedometer"))},dependencies:[T,m.An,I.$z,nt.C,it.B,z.U,y.B,f.D9,S.B],encapsulation:2,changeDetection:0})};function lt(n,r){if(1&n){const e=t.RV6();t.j41(0,"app-chord-practice-setting",0),t.bIt("selectionChange",function(i){t.eBV(e);const s=t.XpG();return t.Njj(s.onChordSelectionChange(i))})("startPractice",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.startChordPractice())}),t.k0s()}if(2&n){const e=t.XpG();t.Y8G("chords",e.chords())("selectedChordIds",e.selectedChordIds())}}function ht(n,r){1&n&&t.nrm(0,"app-chord-practice")}g=(0,A.Cg)([(0,k.d)()],g);let pt=(()=>{class n{constructor(){this.chordStore=(0,t.WQX)(F.C),this.keyboardLayout=(0,t.WQX)(M.h).selectedEntity,this.chordPracticeStore=(0,t.WQX)(j),this.selectedChordIds=(0,t.vPA)(new Set),this.stage=(0,t.vPA)("setting"),this.chords=(0,t.EWP)(()=>{const e=this.chordStore.entities(),o=this.keyboardLayout();return e.map(i=>{const s=i.output.map(c=>(0,u.VW)(c,o));return{...i,inputKeys:i.input.map(c=>(0,u.VW)(c,o)),outputKeys:s,outputText:s.filter(c=>"character"===c?.type).map(c=>c?.value).join("")}}).filter(i=>i.inputKeys.every(s=>null!==s)&&i.outputKeys.every(s=>null!==s))})}onChordSelectionChange({options:e}){let o=this.selectedChordIds();e.forEach(i=>{i.selected?o.add(i.value.id):o.delete(i.value.id)}),this.selectedChordIds.set(o)}startChordPractice(){this.chordPracticeStore.setChords(this.chords().filter(e=>this.selectedChordIds().has(e.id))),this.stage.set("practice")}static#t=this.\u0275fac=function(o){return new(o||n)};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["app-chord-page"]],standalone:!0,features:[t.aNF],decls:2,vars:1,consts:[[3,"selectionChange","startPractice","chords","selectedChordIds"]],template:function(o,i){if(1&o&&t.DNE(0,lt,1,2)(1,ht,1,0),2&o){let s;t.vxM(0,"setting"===(s=i.stage())?0:"practice"===s?1:-1)}},dependencies:[w,g],encapsulation:2,changeDetection:0})}return n})()}}]);