"use strict";(self.webpackChunkalnitak=self.webpackChunkalnitak||[]).push([[193],{7193:(ft,b,a)=>{a.r(b),a.d(b,{ChordPageComponent:()=>ut});var t=a(4438),I=a(8834),m=a(9213),P=a(3902),p=a(6138),$=a(2510),y=a(8018);const R=(0,a(4019).A)(function(e,n){return Array.prototype.slice.call(n,0).sort(e)});var f=a(9189),S=a(1834),F=a(7508);function G(r,e){if(1&r&&t.EFF(0),2&r){const n=t.XpG().$implicit;t.SpI(" ",n.value," ")}}function V(r,e){if(1&r&&(t.j41(0,"mat-icon"),t.EFF(1),t.nI1(2,"iconGuard"),t.k0s()),2&r){const n=t.XpG().$implicit;t.R7$(),t.SpI(" ",t.bMT(2,1,n.value)," ")}}function D(r,e){1&r&&(t.j41(0,"span"),t.EFF(1,"+"),t.k0s())}function W(r,e){if(1&r&&t.DNE(0,G,1,1)(1,V,3,3,"mat-icon")(2,D,2,0,"span"),2&r){const i=e.$index,o=e.$count;t.vxM("character"===e.$implicit.type?0:1),t.R7$(2),t.vxM(i!==o-1?2:-1)}}let N=(()=>{var r;class e{constructor(){this.keys=t.hFB.required()}static#t=r=()=>(this.\u0275fac=function(o){return new(o||e)},this.\u0275cmp=t.VBU({type:e,selectors:[["app-chord-input-keys"]],inputs:{keys:[1,"keys"]},standalone:!0,features:[t.aNF],decls:2,vars:0,template:function(o,s){1&o&&t.Z7z(0,W,3,2,null,null,t.Vm6),2&o&&t.Dyx(s.keys())},dependencies:[m.An,f.B],encapsulation:2,changeDetection:0}))}return r(),e})();function Q(r,e){if(1&r&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&r){const n=t.XpG().$implicit;t.R7$(),t.JRh(n.value)}}function X(r,e){if(1&r&&(t.j41(0,"mat-icon",0),t.EFF(1),t.nI1(2,"iconGuard"),t.k0s()),2&r){const n=t.XpG().$implicit;t.Y8G("inline",!0),t.R7$(),t.JRh(t.bMT(2,2,n.value))}}function L(r,e){1&r&&t.DNE(0,Q,2,1,"span")(1,X,3,4,"mat-icon",0),2&r&&t.vxM("character"===e.$implicit.type?0:1)}let T=(()=>{var r;class e{constructor(){this.keys=t.hFB.required(),this.hostClasses=["inline-flex","align-center"]}static#t=r=()=>(this.\u0275fac=function(o){return new(o||e)},this.\u0275cmp=t.VBU({type:e,selectors:[["app-chord-output-keys"]],hostVars:2,hostBindings:function(o,s){2&o&&t.HbH(s.hostClasses)},inputs:{keys:[1,"keys"]},standalone:!0,features:[t.aNF],decls:2,vars:0,consts:[[3,"inline"]],template:function(o,s){1&o&&t.Z7z(0,L,2,1,null,null,t.Vm6),2&o&&t.Dyx(s.keys())},dependencies:[m.An,f.B],encapsulation:2,changeDetection:0}))}return r(),e})();const U=["fileInput"],Y=(r,e)=>e.id;function w(r,e){if(1&r&&(t.j41(0,"mat-list-option",7),t.nrm(1,"app-chord-input-keys",9),t.EFF(2," -> "),t.nrm(3,"app-chord-output-keys",9),t.k0s()),2&r){const n=e.$implicit,i=t.XpG();t.Y8G("color","primary")("value",n)("togglePosition","before")("selected",i.selectedChordIds().has(n.id)),t.R7$(),t.Y8G("keys",n.inputKeys),t.R7$(2),t.Y8G("keys",n.outputKeys)}}const A=R((r,e)=>r-e);let O=(()=>{var r;class e{constructor(){this.chordStore=(0,t.WQX)(F.C),this.chords=t.hFB.required(),this.selectedChordIds=t.hFB.required(),this.selectionChange=(0,t.CGW)(),this.startPractice=(0,t.CGW)(),this.classes="flex flex-col"}loadChordFile(){if(typeof FileReader>"u")return;const i=this.fileInput.nativeElement;if(null===i.files||0===i.files.length)return;const o=new FileReader;o.onload=s=>{if(!s.target?.result)return;const c=JSON.parse(s.target.result);if(!c)return;let l=null;l=c.history?c.history[0].find(h=>"chords"===h.type):c,l&&(0,p.M8)(this.chordStore,(0,$.a8)(l.chords.map(([h,d])=>{const E=h.filter(mt=>mt>0);return{id:A(E).join("_"),input:E,output:d}})))},o.readAsText(i.files[0])}onChordSelectionChange(i){this.selectionChange.emit(i)}static#t=r=()=>(this.\u0275fac=function(o){return new(o||e)},this.\u0275cmp=t.VBU({type:e,selectors:[["app-chord-practice-setting"]],viewQuery:function(o,s){if(1&o&&t.GBs(U,5),2&o){let c;t.mGM(c=t.lsd())&&(s.fileInput=c.first)}},hostVars:2,hostBindings:function(o,s){2&o&&t.HbH(s.classes)},inputs:{chords:[1,"chords"],selectedChordIds:[1,"selectedChordIds"]},outputs:{selectionChange:"selectionChange",startPractice:"startPractice"},standalone:!0,features:[t.aNF],decls:41,vars:42,consts:[["fileInput",""],[1,"flex","h-12","flex-none","items-center","bg-gray-700","px-5"],[1,"flex-1","list-inside","list-decimal","overflow-auto","p-5"],["href","https://charachorder.io/","target","_blank","rel","noopener",1,"underline"],["type","button","mat-flat-button","",1,"my-2",3,"click","color"],["hidden","","type","file","accept",".json",3,"change"],[1,"!my-2","max-h-56","overflow-auto","rounded","border",3,"selectionChange"],[3,"color","value","togglePosition","selected"],["type","button","mat-flat-button","",1,"my-2",3,"click","color","disabled"],[3,"keys"]],template:function(o,s){if(1&o){const c=t.RV6();t.j41(0,"section",1),t.EFF(1),t.nI1(2,"translate"),t.nI1(3,"realTitleCase"),t.k0s(),t.j41(4,"ol",2)(5,"li"),t.EFF(6),t.nI1(7,"translate"),t.j41(8,"a",3),t.EFF(9),t.nI1(10,"translate"),t.k0s(),t.EFF(11),t.nI1(12,"translate"),t.nrm(13,"br"),t.j41(14,"button",4),t.bIt("click",function(){t.eBV(c);const h=t.sdS(22);return t.Njj(h.click())}),t.j41(15,"mat-icon"),t.EFF(16),t.nI1(17,"iconGuard"),t.k0s(),t.EFF(18),t.nI1(19,"translate"),t.nI1(20,"realTitleCase"),t.k0s(),t.j41(21,"input",5,0),t.nI1(23,"translate"),t.bIt("change",function(){return t.eBV(c),t.Njj(s.loadChordFile())}),t.k0s()(),t.j41(24,"li"),t.EFF(25),t.nI1(26,"translate"),t.j41(27,"mat-selection-list",6),t.bIt("selectionChange",function(h){return t.eBV(c),t.Njj(s.onChordSelectionChange(h))}),t.Z7z(28,w,4,6,"mat-list-option",7,Y),t.k0s()(),t.j41(30,"li"),t.EFF(31),t.nI1(32,"translate"),t.nrm(33,"br"),t.j41(34,"button",8),t.bIt("click",function(){return t.eBV(c),t.Njj(s.startPractice.emit())}),t.j41(35,"mat-icon"),t.EFF(36),t.nI1(37,"iconGuard"),t.k0s(),t.EFF(38),t.nI1(39,"translate"),t.nI1(40,"realTitleCase"),t.k0s()()()}2&o&&(t.R7$(),t.SpI(" ",t.bMT(3,16,t.bMT(2,14,"chord-page.chord-practice-setting.title")),"\n"),t.R7$(5),t.SpI(" ",t.bMT(7,18,"chord-page.chord-practice-setting.import-chord-list-file-step.0")," "),t.R7$(3),t.SpI("",t.bMT(10,20,"chord-page.chord-practice-setting.import-chord-list-file-step.1")," "),t.R7$(2),t.SpI(" ",t.bMT(12,22,"chord-page.chord-practice-setting.import-chord-list-file-step.2")," "),t.R7$(3),t.Y8G("color","primary"),t.R7$(2),t.JRh(t.bMT(17,24,"upload")),t.R7$(2),t.SpI(" ",t.bMT(20,28,t.bMT(19,26,"general.choose-file-action"))," "),t.R7$(3),t.BMQ("aria-label",t.bMT(23,30,"chord-page.chord-practice-setting.file-input-aria-label")),t.R7$(4),t.SpI(" ",t.bMT(26,32,"chord-page.chord-practice-setting.select-chords-step")," "),t.R7$(3),t.Dyx(s.chords()),t.R7$(3),t.SpI(" ",t.bMT(32,34,"chord-page.chord-practice-setting.click-start-button-step")," "),t.R7$(3),t.Y8G("color","primary")("disabled",0===s.selectedChordIds().size),t.R7$(2),t.JRh(t.bMT(37,36,"play_arrow")),t.R7$(2),t.SpI(" ",t.bMT(40,40,t.bMT(39,38,"general.start-action"))," "))},dependencies:[I.$z,m.An,P.p6,P.oh,N,T,f.B,y.D9,S.B],encapsulation:2,changeDetection:0}))}return r(),e})();var H=a(1635),z=a(8954),k=a(9894),J=a(605),Z=a(6148),_=a(1380),q=a(1159),tt=a(4796),C=a(6898);const j=(0,p.Eu)({providedIn:"root",protectedState:!1},(0,tt.JT)("chordPractice"),(0,p.Q2)({chords:null,queue:[],history:[],lastCorrectChordTime:null,chordIntervals:[],buffer:[]}),(0,p.RI)(r=>({setChords(e){(0,p.M8)(r,()=>({chords:e,queue:(0,C.q)(e,20),history:[],chordIntervals:[]}))},airType(){(0,p.M8)(r,({queue:e,chords:n,history:i,lastCorrectChordTime:o,chordIntervals:s})=>{if(!n)return{};const c=Date.now();return{queue:[...e.slice(1),(0,C.QD)(n)],history:[...i,e[0]].slice(-3),lastCorrectChordTime:c,chordIntervals:o?[...s,c-o]:[...s],buffer:[]}})},input(e){(0,p.M8)(r,({buffer:n,queue:i,chords:o,history:s,lastCorrectChordTime:c,chordIntervals:l})=>{if(!o)return{};const h=Date.now(),d=[...n];if("deleteContentBackward"===e.inputType)d.pop();else{if("insertText"!==e.inputType||!e.data)return{};d.push(e.data)}return d.join("").trim()===i[0].outputText?{queue:[...i.slice(1),(0,C.QD)(o)],history:[...s,i[0]].slice(-3),lastCorrectChordTime:h,chordIntervals:c?[...l,h-c]:[...l],buffer:[]}:{buffer:d}})}})),(0,p.QO)(r=>({chpm:(0,t.EWP)(()=>{const e=r.chordIntervals(),n=e.reduce((o,s)=>o+s,0)/1e3/60;return 0===n?0:Math.floor(e.length/n)})})));var x,nt=a(181),M=a(7877),it=a(9263),u=a(2097),rt=a(5888),st=a(629);const ct=["input"];function at(r,e){1&r&&t.nrm(0,"app-chord-output-keys",5),2&r&&t.Y8G("keys",e.$implicit.outputKeys)}function lt(r,e){1&r&&t.nrm(0,"app-chord-output-keys",5),2&r&&t.Y8G("keys",e.$implicit.outputKeys)}function ht(r,e){if(1&r&&(t.nrm(0,"app-speedometer",15),t.nI1(1,"translate")),2&r){const n=t.XpG();t.AVh("opacity-50",n.isFocus()),t.Y8G("speed",n.chordPracticeStore.chpm())("maxSpeed",100)("speedUnit",t.bMT(1,5,"general.chord-speed-unit"))}}let g=(class v{constructor(){this.chordPracticeStore=(0,t.WQX)(j),this.visibilitySettingStore=(0,t.WQX)(it.e),this.hotkeysService=(0,t.WQX)(z.dr),this.isFocus=(0,t.vPA)(!1),this.shortcuts={startPractice:"space",pausePractice:"escape"},this.classes="flex flex-col h-full",this.keyboardLayout=(0,t.WQX)(M.h).selectedEntity,this.deviceLayout=(0,t.WQX)(nt.G).selectedEntity,this.airModeSettingStore=(0,t.WQX)(q.$),this.translateService=(0,t.WQX)(y.c$),this.practiceCharactersDevicePositionCodes=(0,t.EWP)(()=>{const e=this.chordPracticeStore.chords(),n=this.deviceLayout(),i=this.keyboardLayout();return[...new Set(e?.map(s=>s.input).flat())].map(s=>{const c=(0,u.VW)(s,i);return c?{c:c.value,characterDeviceKeys:(0,u.U)([{actionCode:s,shiftKey:!1,altGraphKey:!1}],n)}:null})}),this.keyLabelMap=(0,t.EWP)(()=>{const e=this.practiceCharactersDevicePositionCodes();if(!e)return{};const n={};return e.forEach(i=>{i?.characterDeviceKeys?.forEach(({characterKeyPositionCode:o,layer:s,shiftKey:c,altGraphKey:l})=>{const h={type:_.g0.String,c:i.c,title:this.translateService.instant("general.character-tooltip",{character:i.c}),layer:s,shiftKey:c,altGraphKey:l};n[o]?n[o].push(h):n[o]=[h]})}),n}),this.highlightChordKeyCombinationMap=(0,t.EWP)(()=>{const e=this.chordPracticeStore.chords(),n=this.deviceLayout();if(!this.practiceCharactersDevicePositionCodes())return{};const o={};return e?.forEach(s=>{o[s.id]={characterKeyPositionCode:-1,layer:_.Wd.Primary,shiftKey:!1,altGraphKey:!1,positionCodes:s.input.map(c=>(0,u.U)([{actionCode:c,shiftKey:!1,altGraphKey:!1}],n)?.map(l=>l.characterKeyPositionCode)).flat(),score:0}}),o}),this.highlightKeyCombination=(0,t.EWP)(()=>{const e=this.chordPracticeStore.queue()[0];return this.highlightChordKeyCombinationMap()[e.id]})}onInput(e){this.chordPracticeStore.input(e)}startPractice(){if(this.input.nativeElement.focus(),this.airModeSettingStore.enabled()){const n=this.airModeSettingStore.chordSpeed();(0,J.Y)(6e4/n).pipe((0,k.s)(this)).subscribe(()=>{this.chordPracticeStore.airType()})}}endPractice(){this.input.nativeElement.blur()}ngOnInit(){this.hotkeysService.addShortcut({keys:this.shortcuts.startPractice}).subscribe(()=>{this.startPractice()}),this.hotkeysService.addShortcut({keys:this.shortcuts.pausePractice,allowIn:["INPUT"]}).subscribe(()=>{this.endPractice()})}ngOnDestroy(){this.hotkeysService.removeShortcuts([this.shortcuts.startPractice,this.shortcuts.pausePractice])}static#t=x=()=>(this.\u0275fac=function(n){return new(n||v)},this.\u0275cmp=t.VBU({type:v,selectors:[["app-chord-practice"]],viewQuery:function(n,i){if(1&n&&t.GBs(ct,7),2&n){let o;t.mGM(o=t.lsd())&&(i.input=o.first)}},hostVars:2,hostBindings:function(n,i){2&n&&t.HbH(i.classes)},standalone:!0,features:[t.aNF],decls:27,vars:20,consts:[["input",""],[1,"flex","h-12","flex-none","items-center","bg-gray-700","px-5"],[1,"flex-none"],[1,"relative","h-16","overflow-hidden"],[1,"history","absolute","top-2","space-x-1","whitespace-nowrap","text-gray-300"],[3,"keys"],[1,"absolute","left-24","top-2","space-x-1","whitespace-nowrap"],[1,"absolute","bottom-2","left-24","whitespace-nowrap","text-alnitak-300"],[1,"animate-ping","border-l","border-solid","border-alnitak-300"],["type","text","inputmode","none",1,"peer","h-0","w-0","opacity-0",3,"input","focus","blur"],[1,"absolute","inset-0","flex","cursor-pointer","items-center","justify-center","gap-2","bg-gray-500","text-white","peer-focus:pointer-events-none","peer-focus:opacity-0"],["mat-flat-button","",3,"click"],[1,"text-white"],[1,"box-border","block","flex-1","overflow-hidden","px-5","pb-5",3,"showThumb3Switch","keyLabelMap","highlightKeyCombination"],["class","absolute bottom-4 right-4 h-24 w-24 opacity-50",3,"opacity-50","speed","maxSpeed","speedUnit",4,"appVisible"],[1,"absolute","bottom-4","right-4","h-24","w-24","opacity-50",3,"speed","maxSpeed","speedUnit"]],template:function(n,i){if(1&n){const o=t.RV6();t.j41(0,"section",1),t.EFF(1),t.nI1(2,"translate"),t.nI1(3,"realTitleCase"),t.k0s(),t.j41(4,"section",2)(5,"div",3)(6,"div",4),t.Z7z(7,at,1,1,"app-chord-output-keys",5,t.Vm6),t.k0s(),t.j41(9,"div",6),t.Z7z(10,lt,1,1,"app-chord-output-keys",5,t.Vm6),t.k0s(),t.j41(12,"div",7),t.EFF(13),t.nrm(14,"span",8),t.k0s(),t.j41(15,"input",9,0),t.bIt("input",function(c){return t.eBV(o),t.Njj(i.onInput(c))})("focus",function(){return t.eBV(o),t.Njj(i.isFocus.set(!0))})("blur",function(){return t.eBV(o),t.Njj(i.isFocus.set(!1))}),t.k0s(),t.j41(17,"div",10)(18,"button",11),t.bIt("click",function(){return t.eBV(o),t.Njj(i.startPractice())}),t.j41(19,"mat-icon",12),t.EFF(20),t.nI1(21,"iconGuard"),t.k0s(),t.EFF(22),t.nI1(23,"translate"),t.nI1(24,"realTitleCase"),t.k0s()()()(),t.nrm(25,"app-layout",13),t.DNE(26,ht,2,7,"app-speedometer",14)}2&n&&(t.R7$(),t.SpI(" ",t.bMT(3,12,t.bMT(2,10,"chord-page.chord-practice.title")),"\n"),t.R7$(5),t.xc7("right","calc(100% - 96px)"),t.R7$(),t.Dyx(i.chordPracticeStore.history()),t.R7$(3),t.Dyx(i.chordPracticeStore.queue()),t.R7$(3),t.SpI(" ",i.chordPracticeStore.buffer().join(""),""),t.R7$(7),t.JRh(t.bMT(21,14,"play_arrow")),t.R7$(2),t.SpI(" ",t.bMT(24,18,t.bMT(23,16,"general.start-action"))," "),t.R7$(3),t.Y8G("showThumb3Switch",i.visibilitySettingStore.layoutThumb3Switch())("keyLabelMap",i.keyLabelMap())("highlightKeyCombination",i.isFocus()?i.highlightKeyCombination():null),t.R7$(),t.Y8G("appVisible","speedometer"))},dependencies:[T,m.An,I.$z,rt.C,st.B,Z.U,f.B,y.D9,S.B],encapsulation:2,changeDetection:0}),this)},x());function pt(r,e){if(1&r){const n=t.RV6();t.j41(0,"app-chord-practice-setting",1),t.bIt("selectionChange",function(o){t.eBV(n);const s=t.XpG();return t.Njj(s.onChordSelectionChange(o))})("startPractice",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.startChordPractice())}),t.k0s()}if(2&r){const n=t.XpG();t.Y8G("chords",n.chords())("selectedChordIds",n.selectedChordIds())}}function dt(r,e){1&r&&t.nrm(0,"app-chord-practice")}g=(0,H.Cg)([(0,k.d)()],g);let ut=(()=>{var r;class e{constructor(){this.chordStore=(0,t.WQX)(F.C),this.keyboardLayout=(0,t.WQX)(M.h).selectedEntity,this.chordPracticeStore=(0,t.WQX)(j),this.selectedChordIds=(0,t.vPA)(new Set),this.stage=(0,t.vPA)("setting"),this.chords=(0,t.EWP)(()=>{const i=this.chordStore.entities(),o=this.keyboardLayout();return i.map(s=>{const c=s.output.map(l=>(0,u.VW)(l,o));return{...s,inputKeys:s.input.map(l=>(0,u.VW)(l,o)),outputKeys:c,outputText:c.filter(l=>"character"===l?.type).map(l=>l?.value).join("")}}).filter(s=>s.inputKeys.every(c=>null!==c)&&s.outputKeys.every(c=>null!==c))})}onChordSelectionChange({options:i}){let o=this.selectedChordIds();i.forEach(s=>{s.selected?o.add(s.value.id):o.delete(s.value.id)}),this.selectedChordIds.set(o)}startChordPractice(){this.chordPracticeStore.setChords(this.chords().filter(i=>this.selectedChordIds().has(i.id))),this.stage.set("practice")}static#t=r=()=>(this.\u0275fac=function(o){return new(o||e)},this.\u0275cmp=t.VBU({type:e,selectors:[["app-chord-page"]],standalone:!0,features:[t.aNF],decls:2,vars:1,consts:[[3,"chords","selectedChordIds"],[3,"selectionChange","startPractice","chords","selectedChordIds"]],template:function(o,s){if(1&o&&t.DNE(0,pt,1,2,"app-chord-practice-setting",0)(1,dt,1,0,"app-chord-practice"),2&o){let c;t.vxM("setting"===(c=s.stage())?0:"practice"===c?1:-1)}},dependencies:[O,g],encapsulation:2,changeDetection:0}))}return r(),e})()}}]);